<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>reveal.js - The HTML Presentation Framework</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Java Annotation</h1>
					<h3>Denpendency Injection and Beyond</h3>
					<p>
						<large style="color:steelblue">Yong Fu</a> </large>
					</p>
				</section>

				<section>
					<h2>What is annotation?</h2>
				</section>

				<section>
					<blockquote cite="http://www.merriam-webster.com/dictionary/annotation">
						&ldquo; A note added to a text,book, drawing, etc., as a comment or explanation.&rdquo;
					</blockquote>
					<p align="right" style="color : steelblue"> Webster</p>
				</section>

				<section>
					<blockquote cite="http://wikipedia/annotation">
						&ldquo; An annotation is metadata (e.g. a comment, explanation, presentational markup) attached to text, image, or other data.&rdquo;
					</blockquote>
					<p align="right" style="color : steelblue"> Wikipedia</p>
				</section>

				<section>
					<blockquote cite="http://wikipedia/annotation">
						&ldquo;  A Metadata facility that enables you to embed supplemental information in a source file.&rdquo;
					</blockquote>
					<p align="right" style="color : steelblue"> Java Documents</p>

				</section>

				<section>
					<h3>History of Java Annotation</h3>
						<ul>
						<li>JSR-175 : A Metadata Facility for the Java Programming Language</li>
						<li>JSR-250 : Common Annotations</li>
						<li>JSR-269 : Pluggable Annotation Processing API</li>
						<li>Java 8 enhancements</li>
						</ul>
				</section>

				<section>
					<h3>Basics of Java Annotation</h3>
					<pre><code data-trim contenteditable>
@interface MyAnnotation {
	String str();
	int val();
}
					</code></pre>
				<ul>
				<li> <i style="color:steelblue">@interface</i> for annotation </li>
				<li> All annotation extends Annotation </li>
				<li> Only member functions </li>
				</ul>
				</section>

				<section>
					<h3>Basics of Java Annotation</h3>
					<pre><code data-trim contenteditable>
@MyAnnotation(str="Example", val = 1)
public static void myMethod() {...}
					</code></pre>
				</section>

				<section>
					<h3>Built-in Java Annotations</h3>
					<p> Java has built-in annotations for generous purpose.</p>
					<ul>
						<li>Annotations for code</li>
						<li>Annotations for annotations (Meta-annotation)</li>
					</ul>
				</section>

				<section>
					<h3>Built-in Java Annotations for Code</h3>
					<ul>
						<li>
							@Override 
						</li>
						<li>
							@Deprecated 
						</li>
						<li>
							@supressWarnings
						</li>
						<li>
							@SafeVarargs <br> <span style="font-size:80%;color:steelblue">Suppress warnings for all functions with a generics <em>varargs</em> parameter (Java 7) </span>
						</li>
						<li>
							@FunctionalInterface <br> <span style="font-size:80%;color:steelblue"> Specifies that the type declaration is a functional interface (Java 8) </span>
						</li>
					</ul>
				</section>


				<section>
					<h3>Built-in Java Annotations for annotations (Meta-annotation)</h3>
					<ul>
						<li>
							<a href="#/11">@Target</a> 
						</li>
						<li>
							<a href="#/12">@Retention</a> 
						</li>
						<li>
							<a href="#/13">@Documented</a> 
						</li>
						<li>
							<a href="#/14">@Inherited</a> 
						</li>
					</ul>
				</section>

				<section>
					<h3>@Target</h3>
					Program element type be annotated
					<pre><code data-trim contenteditable>
@Target(ElementType.METHOD, ElementType.Type)
public @interface MetaAnnotationType {
    ...
}
    				</code></pre>	

    				<pre><code data-trim contenteditable>
@MetaAnnotationType(...)
class myAnnotatedClass{
    ...
}
    				</code></pre>			
				</section>

				<section>
					<h3>@Retention</h3>
					Annotations can be hold during compilation (SOURCE), recorded into class file (CLASS) or in runtime (VM)
						
				</section>

				<section>
					<h3>@Documented</h3>
					Annotations with a type are to be documented by Java Doc and similar tools by default
					<pre><code data-trim contenteditable>
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Inherited
@Documented
public @interface Transactional {...}
    				</code></pre>			
				</section>


				<section>
					<h3>@Inherited</h3>
					An annotation type is automatically inherited from its super class.
					<pre><code data-trim contenteditable>
// declare annotation
@Inherited
public @interface myInheritedAnnotation {
}
// apply annotation
@MyAnnotation
public class mySuperClass { ... }
public class mySubClass extends mySuperClass { ... }
    				</code></pre>			
				</section>

				<section>
					<h3>
						Java 8 Enhancement
					</h3>
					<ul>
						<li>
							<a href="#/16">Type Annotation</a>
						</li>
						<li>
							<a href="#/17">@Repeatable</a>
						</li>
						<li>
							<a href="#/18">Native Annotation</a>
						</li>
					</ul>
				</section>

				<section>
					<h3>
						Type Annotation
					</h3>
					<pre><code data-trim contenteditable>
@Target(ElementType.TYPE_USE)
@interface TypeAnnotation { ... }
    				</code></pre>								
					<pre><code data-trim contenteditable>
void method() throws @TypeAnnotation NullPointerException {...}
    				</code></pre>		
					<pre><code data-trim contenteditable>
@Target(ElementType.TYPE_PARAMETER)
@interface TypeParameterAnnotation { ... }
    				</code></pre>
					<pre><code data-trim contenteditable>
class typeAnnotationClass&lt@TypeParameterAnnotation T&gt {...}
    				</code></pre>		    						
    			</section>

				<section>
					<h3>
						@Repeatable
					</h3>
					<pre><code data-trim contenteditable>
@Schedule(dayOfMonth="last")
@Schedule(dayOfWeek="Fri", hour="23")
public void doPeriodicCleanup() { ... }
    				</code></pre>								
    			</section>    			


				<section>
					<h3>
						@Native
					</h3>
					This annotation indicates that an annotated field defining a constant value may be referenced from native code.
    			</section>    			

    			<section>
    				<h3>
    					Process Custom Annotations
    				</h3>
    				<ul>
    					<li>
    						Compile time 
    						<p><em>Annotation Processors will handle the different annotations found in code being compiled.</em><p>
    					</li>
    					<li>
    						Runtime  
    						<p><em>Annotations with runtime retention policy are accessible through reflection.</em></p>
    					</li>
    				</ul>

    			</section>

    			<section>
    				<h3>
    					Annotation Processing Framework
    				</h3>
    				<ol>
    					<li>
    						Create an instance of a <span style="color:steelblue">Java annotation Processor </span>.
    					</li>
    					<li>
    						Call the init method with an appropriate <span style="color:steelblue"> ProcessingEnvironment </span>.
    					</li>
    					<li>
    						Set up <span style="color:steelblue">SupportedAnnotationTypes, SupportedOptions</span>  and <span style="color:steelblue"> SupportedSourceVersion </span>.
    					</li>
    					<li>
    						Call the process method on the <span style="color:steelblue">Processor</span> object; there may be done in multiple rounds.
    					</li>
    				</ol>
    			</section>


    			<section>
    				<h3>
    					Simple Example
    				</h3>
    				<pre><code data-trim contenteditable>
@Retention(RetentionPolicy.SOURCE)
public @interface PrintAnnotation {}
    				</code></pre>	
    			</section>

    			<section>
    				<h3>
    					Annotation Processor
    				</h3>
					<pre><code data-trim contenteditable>
@SupportedAnnotationTypes({"com.ociweb.annotation.PrintAnnotation"})
@SupportedSourceVersion(SourceVersion.RELEASE_6)
public class PrintAnnotationProcessor extends AbstractProcessor {
@Override
	public synchronized void init(ProcessingEnvironment env){ }
@Override
public boolean process(Set&lt? extends TypeElement&gt annotations, RoundEnvironment roundEnvironment) {
        for (TypeElement te : annotations) {
            for (Element e : roundEnvironment.getElementsAnnotatedWith(te)) {
                String message = "Annotation " + te.getSimpleName();
    		    env.getMessager().printMessage(Diagnostic.Kind.NOTE, message);
            }
        }
    	return true;
    }
}
    				</code></pre>						    				
    			</section>

    			<section>
    				<h3>Dagger</h3>
    				Dagger is a java tool that implements the dependency injection design pattern. Compatible to JSR330  (Dependency Injection for Java).

    			</section>

    			<section>
    				<h3>
    					Dagger Example
    				</h3>
					<pre><code data-trim contenteditable>
import dagger.Component;
import javax.inject.Singleton;

@Singleton
@Component(modules = {TweeterModule.class, NetworkModule.class})
    public interface ApplicationComponent {
    Tweeter getTweeter();
    Timeline getTimeline();
}
				</code></pre>  				
    			</section>

    			<section>
    				<h3>
    					Dagger Example
    				</h3>
					<pre><code data-trim contenteditable>
...
import dagger.Module;
import dagger.Provides;

@Module
public class TweeterModule {

    @Provides
    @Singleton
    public Tweeter provideTweeter(TwitterApi twitterApi) {
        return new Tweeter(twitterApi);
    }

    @Provides
    @Singleton
    public Timeline provideTimeline(TwitterApi twitterApi) {
        return new Timeline(twitterApi);
    }
    ...
}
				</code></pre>  				

    			</section>

    			<section>
    				<h3>
    					Dagger Example
    				</h3>
					<pre><code data-trim contenteditable>
import javax.inject.Inject;
public class Tweeter {
    private final TwitterApi twitterApi;
    
    @Inject
    public Tweeter(TwitterApi twitterApi) {
        this.twitterApi = twitterApi;
    }
    
    public void tweet(String tweetChars) {
        twitterApi.sendTweet(tweetChars);
    }
}
				</code></pre>  				
    			</section>


    			
    			<section>
    				<h3>
    					Dagger Example
    				</h3>
					<pre><code data-trim contenteditable>
import javax.inject.Inject;
import java.util.ArrayList;
import java.util.List;

public class TwitterApi {

    private final String user;
    private final OkHttpClient httpClient;

    @Inject
    public TwitterApi(String user, OkHttpClient httpClient) {
        this.user = user;
        this.httpClient = httpClient;
    }
    ...
}
				</code></pre>  				
    			</section>

    			<section>
    				<h3>
    					Dagger Annotation Processing
    				</h3>
					<pre><code data-trim contenteditable>					
public final class ComponentProcessor extends BasicAnnotationProcessor {
...
public SourceVersion getSupportedSourceVersion() {...}
public Set&ltString&gt getSupportedOptions() {...}
// return processing steps
protected Iterable&ltProcessingStep&gt initSteps() {
    Messager messager = processingEnv.getMessager();
    Types types = processingEnv.getTypeUtils();
    Elements elements = processingEnv.getElementUtils();
    Filer filer = processingEnv.getFiler();
    ...
    return ImmutableList.&ltProcessingStep&gtof(
        new MapKeyProcessingStep(
            messager,
            mapKeyValidator,
            mapKeyGenerator),
    ...
}   
				</code></pre>  				
    			</section>


    			<section>
    				<h3>
    					Dagger Annotation Processing
    				</h3>
					<pre><code data-trim contenteditable>					
public void process(SetMultimap&ltClass&lt? extends Annotation&gt, Element&gt elementsByAnnotation) {
    Map&ltElement, ValidationReport&ltTypeElement&gt&gt builderReportsByComponent =
        processComponentBuilders(elementsByAnnotation.get(Component.Builder.class));
  ...
  }
				</code></pre>  				
					<pre><code data-trim contenteditable>					
private Map&ltElement, ValidationReport&ltTypeElement&gt&gt processComponentBuilders(
      Set&lt? extends Element&gt componentBuilderElements) {
    ...
    for (Element element : componentBuilderElements) {
    	...
    }
  }
				</code></pre>  				
    			</section>

    			<section>
    				<h3>Beyond Dependency Injection</h3>
    				<ul>
    					<li>
    						Checker
    					</li>
    					<li>
    						APE
    					</li>
    				</ul>
    			</section>

    			<section>
    				Checker is a framework to enhance Java's type system by adding pluggable type systems to the Java language
					<pre><code data-trim contenteditable>					
    					import org.checkerframework.checker.nullness.qual.*;
public class Example {
    void sample() {
        @NonNull Object ref = null;
    }
}
					</code></pre>
    			</section>

    			<section>
    				<h3>A set of built-in checkers</h3>
    				<ol>
    					<li>
    						Units checker: @Area, @Current
    					</li>
    					<li>
    						Regex checker: @Regex
    					</li>
    					<li>
    						Lock checker: @GuardedBy
    					</li>
    					<li>
    						And your own checkers
    					</li>
    				</ol>
    			</section>

    			<section>
    				APE uses annotation for power management of Android
    				<p align="right" font="italic" ><i>ICSE 2015</i></p>
    			</section>

    			<section>
    	<blockquote cite="http://cseweb.ucsd.edu/~nnikzad/files/APE_ICSE_preprint.pdf">
						&ldquo;power management
policies defer the execution of expensive operations until
the device enters a state that minimizes the cost of that
operation.&rdquo;
					</blockquote>
    			</section>

    			<section>
    				<h3>Example</h3>
    				<p style="color:steelblue">Defer uploads, for up to 30 minutes, until
the Wi-Fi radio has connected to a network. </p>
    			</section>

    			<section>
					<pre><code data-trim contenteditable>					
    			while(true) {
@APE_WaitUntil("(WiFi.Connected, inf)", MaxDelay=1800)
uploadSensorData();
}
					</code></pre>
    			</section>


    			<section>
    				<h3>Under the hood</h3>
    				<ul>
    				<li>
    				Java Annotation processor translates the annotations to RPC of a runtime.
    				</li>
    				<li>
    				The RPC of the runtime is blocked until the runtime detects that all contions are satisfied.
    				</li>
    			</section>


    			<section>
    			<h3>More applications</h3>
    			<ul>
    				<li>Hibernate</li>
    				<li>Spring</li>
    				<li>FindBugs</li>
    				<li>JUnit</li>
    				<li>...</li>
    			</ul>
    			</section>

				<section>
					<h2>Summary</h2>
					<ul>
					<li> Annotation is Metadata</li>
					<li> Java provides annotation processor</li>
					<li> Move stuff other than main logic into annotation</li>
					<li> Build your own annotation!</li>
					</ul>
					
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
